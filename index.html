function setupPlayer() {
    const nameInput = document.getElementById("playerName");
    const timerEl = document.getElementById("timer-display");
    const btn = document.getElementById("remote-button");
    const msg = document.getElementById("status-msg");
    const inputArea = document.getElementById("answer-input-area");

    db.ref("status").on("value", snap => {
        const s = snap.val();
        
        if (s === "active") {
            // 出題中：早押しボタンを表示、タイマーと入力欄は隠す
            btn.style.display = "block";
            inputArea.style.display = "none";
            timerEl.style.display = "none";
            msg.innerText = "早押し！";
            msg.style.color = "#e74c3c";
        } 
        else if (s === "pushed") {
            // ボタンが押された：誰が押したかを確認
            db.ref("winner").once("value", ws => {
                const winnerName = ws.val();
                if (winnerName === nameInput.value) {
                    // 自分が押した：ここで初めてタイマーと入力欄を表示
                    inputArea.style.display = "block";
                    timerEl.style.display = "block"; // タイマー表示
                    msg.innerText = "回答してください！";
                    msg.style.color = "#2ecc71";
                    document.getElementById("playerAnswerField").focus();
                } else {
                    // 他人が押した：タイマーは表示しない
                    btn.style.display = "none";
                    inputArea.style.display = "none";
                    timerEl.style.display = "none";
                    msg.innerText = winnerName + "さんが回答中...";
                    msg.style.color = "#333";
                }
            });
        } else {
            // 待機中（idleなど）
            btn.style.display = "none";
            inputArea.style.display = "none";
            timerEl.style.display = "none";
            msg.innerText = "待機中...";
        }
    });

    // カウントダウン数値の更新監視
    db.ref("countdown").on("value", snap => {
        const val = snap.val();
        if (timerEl && val >= 0) {
            timerEl.innerText = "残り " + val + " 秒";
            // 残り時間による色変化
            if (val <= 3) timerEl.className = "timer-danger";
            else if (val <= 5) timerEl.className = "timer-warn";
            else timerEl.className = "timer-normal";
        }
        // 0秒になったら送信ボタンを無効化
        document.getElementById("submitAnsBtn").disabled = (val <= 0);
    });
}
